{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/SHAIK%20SHAFIYA/Desktop/medical/src/utils/productUtils.ts"],"sourcesContent":["import { Product } from '@/components/ProductCard'; // Assuming ProductCard defines the Product interface\n\nexport const isNearExpiry = (product: Product, monthsThreshold: number = 3): boolean => {\n  if (!product.batches || product.batches.length === 0) {\n    return false;\n  }\n\n  const now = new Date();\n  const thresholdDate = new Date();\n  thresholdDate.setMonth(now.getMonth() + monthsThreshold);\n\n  for (const batch of product.batches) {\n    const expiryDate = new Date(batch.expiry);\n    if (expiryDate <= thresholdDate && expiryDate >= now) {\n      return true; // At least one batch is expiring within the threshold\n    }\n  }\n  return false;\n};\n\nexport const getSoonestExpiry = (product: Product): string | null => {\n  if (!product.batches || product.batches.length === 0) {\n    return null;\n  }\n\n  // Sort batches by expiry date in ascending order\n  const sortedBatches = [...product.batches].sort((a, b) => new Date(a.expiry).getTime() - new Date(b.expiry).getTime());\n\n  // Return the expiry date of the first batch\n  return sortedBatches[0].expiry;\n};\n"],"names":[],"mappings":";;;;;;AAEO,MAAM,eAAe,CAAC,SAAkB,kBAA0B,CAAC;IACxE,IAAI,CAAC,QAAQ,OAAO,IAAI,QAAQ,OAAO,CAAC,MAAM,KAAK,GAAG;QACpD,OAAO;IACT;IAEA,MAAM,MAAM,IAAI;IAChB,MAAM,gBAAgB,IAAI;IAC1B,cAAc,QAAQ,CAAC,IAAI,QAAQ,KAAK;IAExC,KAAK,MAAM,SAAS,QAAQ,OAAO,CAAE;QACnC,MAAM,aAAa,IAAI,KAAK,MAAM,MAAM;QACxC,IAAI,cAAc,iBAAiB,cAAc,KAAK;YACpD,OAAO,MAAM,sDAAsD;QACrE;IACF;IACA,OAAO;AACT;AAEO,MAAM,mBAAmB,CAAC;IAC/B,IAAI,CAAC,QAAQ,OAAO,IAAI,QAAQ,OAAO,CAAC,MAAM,KAAK,GAAG;QACpD,OAAO;IACT;IAEA,iDAAiD;IACjD,MAAM,gBAAgB;WAAI,QAAQ,OAAO;KAAC,CAAC,IAAI,CAAC,CAAC,GAAG,IAAM,IAAI,KAAK,EAAE,MAAM,EAAE,OAAO,KAAK,IAAI,KAAK,EAAE,MAAM,EAAE,OAAO;IAEnH,4CAA4C;IAC5C,OAAO,aAAa,CAAC,EAAE,CAAC,MAAM;AAChC"}},
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/SHAIK%20SHAFIYA/Desktop/medical/src/components/ProductCard.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useState, useEffect, useRef } from 'react';\nimport { ShoppingCart } from 'lucide-react';\nimport { useRole } from '@/context/RoleContext';\nimport { UserRole } from '@/types/roles';\nimport { isNearExpiry, getSoonestExpiry } from '@/utils/productUtils'; // Import the helpers\nimport Link from 'next/link';\nimport { useCart } from '@/context/CartContext'; // Import useCart\n\ninterface Batch {\n  batch_no: string;\n  expiry: string; // YYYY-MM-DD\n  qty: number;\n}\n\nexport interface Product { // Exported for productUtils.ts\n  product_id: string;\n  brand: string;\n  name: string;\n  salt: string; // Added salt property\n  pack_size: string;\n  pricing: Record<UserRole, number>;\n  price_mrp: number; // Added price_mrp property\n  moq: number;\n  stock_qty: number;\n  category: string;\n  image: string;\n  stock_badge: 'In stock' | 'Low stock' | 'Out of stock' | 'Near expiry — discounted';\n  batches?: Batch[]; // Make batches optional\n  is_prescription_required?: boolean; // Added for Request 3\n  gst_rate: number; // Added gst_rate property\n  hsn_code: string; // Added hsn_code property\n}\n\ninterface ProductCardProps {\n  product: Product;\n}\n\nconst stockBadgeClasses = {\n  'In stock': 'bg-emerald-100 text-emerald-800',\n  'Low stock': 'bg-yellow-100 text-yellow-800',\n  'Out of stock': 'bg-red-100 text-red-800',\n  'Near expiry — discounted': 'bg-blue-100 text-blue-800',\n};\n\nconst ProductCard: React.FC<ProductCardProps> = ({ product }) => {\n  const { currentRole, isLoggedIn } = useRole();\n  const { addItem } = useCart(); // Use cart context\n  const isProductNearExpiry = isNearExpiry(product);\n  const soonestExpiry = getSoonestExpiry(product);\n  const quantityRef = useRef<HTMLInputElement>(null); // Ref for quantity input\n\n  let currentStockBadge = product.stock_badge;\n  if (isProductNearExpiry && product.stock_badge !== 'Out of stock') {\n    currentStockBadge = 'Near expiry — discounted';\n  }\n\n  const isOutOfStock = currentStockBadge === 'Out of stock';\n  // Safely get price, default to 0 if undefined/null, ensure it's a number\n  const price = product.pricing?.[currentRole] || product.pricing?.[UserRole.REGULAR] || 0;\n\n  const handleAddToCart = () => {\n    const quantity = parseInt(quantityRef.current?.value || '0', 10);\n    if (isNaN(quantity) || quantity < product.moq) {\n      alert(`Please enter a quantity of at least ${product.moq} units.`);\n      return;\n    }\n    addItem(product, quantity); // Use addItem from context\n    alert(`Added ${quantity} of ${product.name} to cart.`);\n  };\n\n  return (\n    <div className=\"border border-gray-200 rounded-lg p-4 flex flex-col justify-between hover:shadow-lg transition-shadow duration-300 bg-white\">\n      <div>\n        <div className=\"relative w-full h-40 bg-gray-100 rounded-md mb-4 flex items-center justify-center\">\n          {isProductNearExpiry && (\n            <div className=\"absolute top-0 left-0 bg-red-600 text-white text-xs font-bold px-2 py-1 rounded-br-lg\">DEAL</div>\n          )}\n          <img src={product.image} alt={product.name} className=\"max-h-full max-w-full p-2 object-contain\" />\n           <span className={`absolute top-2 right-2 text-xs font-semibold px-2 py-1 rounded-full ${stockBadgeClasses[currentStockBadge]}`}>\n            {currentStockBadge}\n          </span>\n        </div>\n        \n        <p className=\"text-xs text-gray-500 font-medium\">{product.brand}</p>\n        <h3 className=\"text-md font-semibold text-gray-800 mt-1 truncate\" title={product.name}>\n          {product.name}\n        </h3>\n        <p className=\"text-sm text-gray-600 mt-1\">{product.pack_size}</p>\n        {isProductNearExpiry && soonestExpiry && (\n          <p className=\"text-sm text-red-600 mt-1\">Expires: {new Date(soonestExpiry).toLocaleDateString()}</p>\n        )}\n        \n        <div className=\"mt-2\">\n            <p className=\"text-xs text-gray-500\">\n                MOQ: <span className=\"font-bold text-gray-700\">{product.moq} units</span>\n            </p>\n        </div>\n      </div>\n\n      <div className=\"mt-4\">\n        {isLoggedIn ? (\n          <p className=\"text-lg font-bold text-emerald-600\">\n            {typeof price === 'number' ? `₹${price.toFixed(2)}` : 'N/A'}\n            <span className=\"text-sm font-normal text-gray-500\">/box</span>\n          </p>\n        ) : (\n          <p className=\"text-lg font-bold text-gray-500\">\n            <Link href=\"/login\" className=\"text-emerald-600 hover:underline\">Login</Link> to view price\n          </p>\n        )}\n        \n        <div className=\"mt-3 flex items-center space-x-2\">\n            <input \n                type=\"number\" \n                min={product.moq}\n                defaultValue={product.moq}\n                className=\"w-20 px-2 py-1.5 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-emerald-500 text-center\"\n                disabled={isOutOfStock || !isLoggedIn}\n                ref={quantityRef} // Attach ref\n            />\n            <button \n              className={`w-full flex items-center justify-center px-3 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white ${\n                isOutOfStock || !isLoggedIn\n                  ? 'bg-gray-400 cursor-not-allowed' \n                  : 'bg-emerald-600 hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500'\n              }`}\n              disabled={isOutOfStock || !isLoggedIn}\n              onClick={handleAddToCart} // Attach onClick handler\n            >\n              <ShoppingCart size={16} className=\"mr-2\"/>\n              Add\n            </button>\n        </div>\n        {isOutOfStock && <p className=\"text-center text-red-600 text-xs mt-2\">Currently unavailable</p>}\n        {!isOutOfStock && <p className=\"text-center text-gray-500 text-xs mt-2\">Dispatch in 24-48 hrs</p>}\n      </div>\n    </div>\n  );\n};\n\nexport default ProductCard;\n"],"names":[],"mappings":"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"}}]
}