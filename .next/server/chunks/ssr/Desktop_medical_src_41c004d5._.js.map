{"version":3,"sources":["../../../../../../Desktop/medical/src/utils/productUtils.ts","../../../../../../Desktop/medical/src/components/ProductCard.tsx"],"sourcesContent":["import { Product } from '@/components/ProductCard'; // Assuming ProductCard defines the Product interface\n\nexport const isNearExpiry = (product: Product, monthsThreshold: number = 3): boolean => {\n  if (!product.batches || product.batches.length === 0) {\n    return false;\n  }\n\n  const now = new Date();\n  const thresholdDate = new Date();\n  thresholdDate.setMonth(now.getMonth() + monthsThreshold);\n\n  for (const batch of product.batches) {\n    const expiryDate = new Date(batch.expiry);\n    if (expiryDate <= thresholdDate && expiryDate >= now) {\n      return true; // At least one batch is expiring within the threshold\n    }\n  }\n  return false;\n};\n\nexport const getSoonestExpiry = (product: Product): string | null => {\n  if (!product.batches || product.batches.length === 0) {\n    return null;\n  }\n\n  // Sort batches by expiry date in ascending order\n  const sortedBatches = [...product.batches].sort((a, b) => new Date(a.expiry).getTime() - new Date(b.expiry).getTime());\n\n  // Return the expiry date of the first batch\n  return sortedBatches[0].expiry;\n};\n","\"use client\";\n\nimport React, { useState, useEffect, useRef } from 'react';\nimport { ShoppingCart } from 'lucide-react';\nimport { useRole } from '@/context/RoleContext';\nimport { UserRole } from '@/types/roles';\nimport { isNearExpiry, getSoonestExpiry } from '@/utils/productUtils'; // Import the helpers\nimport Link from 'next/link';\nimport { useCart } from '@/context/CartContext'; // Import useCart\n\nexport interface Batch {\n  batch_no: string;\n  expiry: string; // YYYY-MM-DD\n  qty: number;\n}\n\nexport interface Product { // Exported for productUtils.ts\n  id: string;\n  brand: string;\n  name: string;\n  salt: string; // Added salt property\n  pack_size: string;\n  pricing: any;\n  price_mrp: number; // Added price_mrp property\n  moq: number;\n  stock_qty: number;\n  category: string;\n  image: string;\n  stock_badge: 'In stock' | 'Low stock' | 'Out of stock' | 'Near expiry — discounted';\n  batches?: any; // Make batches optional\n  is_prescription_required?: boolean; // Added for Request 3\n  gst_rate: number; // Added gst_rate property\n  hsn_code: string; // Added hsn_code property\n}\n\ninterface ProductCardProps {\n  product: Product;\n}\n\nconst stockBadgeClasses = {\n  'In stock': 'bg-emerald-100 text-emerald-800',\n  'Low stock': 'bg-yellow-100 text-yellow-800',\n  'Out of stock': 'bg-red-100 text-red-800',\n  'Near expiry — discounted': 'bg-blue-100 text-blue-800',\n};\n\nconst ProductCard: React.FC<ProductCardProps> = ({ product }) => {\n  const { currentRole, isLoggedIn } = useRole();\n  const { addItem } = useCart(); // Use cart context\n  const isProductNearExpiry = isNearExpiry(product);\n  const soonestExpiry = getSoonestExpiry(product);\n  const quantityRef = useRef<HTMLInputElement>(null); // Ref for quantity input\n\n  let currentStockBadge = product.stock_badge;\n  if (isProductNearExpiry && product.stock_badge !== 'Out of stock') {\n    currentStockBadge = 'Near expiry — discounted';\n  }\n\n  const isOutOfStock = currentStockBadge === 'Out of stock';\n  // Safely get price, default to 0 if undefined/null, ensure it's a number\n  const price = product.pricing?.[currentRole] || product.pricing?.[UserRole.REGULAR] || 0;\n\n  const handleAddToCart = () => {\n    const quantity = parseInt(quantityRef.current?.value || '0', 10);\n    if (isNaN(quantity) || quantity < product.moq) {\n      alert(`Please enter a quantity of at least ${product.moq} units.`);\n      return;\n    }\n    addItem(product, quantity); // Use addItem from context\n    alert(`Added ${quantity} of ${product.name} to cart.`);\n  };\n\n  return (\n    <div className=\"border border-gray-200 rounded-lg p-4 flex flex-col justify-between hover:shadow-lg transition-shadow duration-300 bg-white\">\n      <div>\n        <div className=\"relative w-full h-40 bg-gray-100 rounded-md mb-4 flex items-center justify-center\">\n          {isProductNearExpiry && (\n            <div className=\"absolute top-0 left-0 bg-red-600 text-white text-xs font-bold px-2 py-1 rounded-br-lg\">DEAL</div>\n          )}\n          <img src={product.image} alt={product.name} className=\"max-h-full max-w-full p-2 object-contain\" />\n           <span className={`absolute top-2 right-2 text-xs font-semibold px-2 py-1 rounded-full ${stockBadgeClasses[currentStockBadge]}`}>\n            {currentStockBadge}\n          </span>\n        </div>\n        \n        <p className=\"text-xs text-gray-500 font-medium\">{product.brand}</p>\n        <h3 className=\"text-md font-semibold text-gray-800 mt-1 truncate\" title={product.name}>\n          {product.name}\n        </h3>\n        <p className=\"text-sm text-gray-600 mt-1\">{product.pack_size}</p>\n        {isProductNearExpiry && soonestExpiry && (\n          <p className=\"text-sm text-red-600 mt-1\">Expires: {new Date(soonestExpiry).toLocaleDateString()}</p>\n        )}\n        \n        <div className=\"mt-2\">\n            <p className=\"text-xs text-gray-500\">\n                MOQ: <span className=\"font-bold text-gray-700\">{product.moq} units</span>\n            </p>\n        </div>\n      </div>\n\n      <div className=\"mt-4\">\n        {isLoggedIn ? (\n          <p className=\"text-lg font-bold text-emerald-600\">\n            {typeof price === 'number' ? `₹${price.toFixed(2)}` : 'N/A'}\n            <span className=\"text-sm font-normal text-gray-500\">/box</span>\n          </p>\n        ) : (\n          <p className=\"text-lg font-bold text-gray-500\">\n            <Link href=\"/login\" className=\"text-emerald-600 hover:underline\">Login</Link> to view price\n          </p>\n        )}\n        \n        <div className=\"mt-3 flex items-center space-x-2\">\n            <input \n                type=\"number\" \n                min={product.moq}\n                defaultValue={product.moq}\n                className=\"w-20 px-2 py-1.5 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-emerald-500 text-center\"\n                disabled={isOutOfStock || !isLoggedIn}\n                ref={quantityRef} // Attach ref\n            />\n            <button \n              className={`w-full flex items-center justify-center px-3 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white ${\n                isOutOfStock || !isLoggedIn\n                  ? 'bg-gray-400 cursor-not-allowed' \n                  : 'bg-emerald-600 hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500'\n              }`}\n              disabled={isOutOfStock || !isLoggedIn}\n              onClick={handleAddToCart} // Attach onClick handler\n            >\n              <ShoppingCart size={16} className=\"mr-2\"/>\n              Add\n            </button>\n        </div>\n        {isOutOfStock && <p className=\"text-center text-red-600 text-xs mt-2\">Currently unavailable</p>}\n        {!isOutOfStock && <p className=\"text-center text-gray-500 text-xs mt-2\">Dispatch in 24-48 hrs</p>}\n      </div>\n    </div>\n  );\n};\n\nexport default ProductCard;\n"],"names":[],"mappings":"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"}